{"ast":null,"code":"import _regeneratorRuntime from\"/home/bogdan/project-manager-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/bogdan/project-manager-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import axios from'axios';import{registerRequest,registerError,loginRequest,loginSuccess,loginError,logoutRequest,logoutSuccess,logoutError,refreshRequest,refreshSuccess,refreshError}from'./auth-actions';axios.defaults.baseURL='https://sbc-backend.goit.global';export var token={token:'',set:function set(token){axios.defaults.headers.common.Authorization=\"Bearer \".concat(token);this.token=\"Bearer \".concat(token);},get:function get(){return this.token;},refresh:function refresh(refreshToken){this.token=refreshToken;axios.defaults.headers.common.Authorization=refreshToken;},unset:function unset(){axios.defaults.headers.common.Authorization='';this.token='';}};var register=function register(user){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch(registerRequest());_context.prev=1;_context.next=4;return axios.post('/auth/register',user);case 4:dispatch(logIn(user));_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](1);dispatch(registerError(_context.t0===null||_context.t0===void 0?void 0:_context.t0.message));case 10:case\"end\":return _context.stop();}}},_callee,null,[[1,7]]);}));return function(_x){return _ref.apply(this,arguments);};}();};var logIn=function logIn(user){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){var response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:dispatch(loginRequest());_context2.prev=1;_context2.next=4;return axios.post('/auth/login',user);case 4:response=_context2.sent;token.set(response.data.accessToken);dispatch(loginSuccess({accessToken:token.get(),refreshToken:\"Bearer \".concat(response.data.refreshToken),sid:response.data.sid,email:response.data.data.email}));_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](1);dispatch(loginError(_context2.t0===null||_context2.t0===void 0?void 0:_context2.t0.message));case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[1,9]]);}));return function(_x2){return _ref2.apply(this,arguments);};}();};var logOut=function logOut(){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:dispatch(logoutRequest());_context3.prev=1;_context3.next=4;return axios.post('/auth/logout');case 4:token.unset();dispatch(logoutSuccess());window.location.reload();_context3.next=12;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](1);dispatch(logoutError(_context3.t0===null||_context3.t0===void 0?void 0:_context3.t0.message));case 12:case\"end\":return _context3.stop();}}},_callee3,null,[[1,9]]);}));return function(_x3){return _ref3.apply(this,arguments);};}();};var refreshOperation=function refreshOperation(){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch,getState){var _getState$auth$token,refreshToken,sid,response;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_getState$auth$token=getState().auth.token,refreshToken=_getState$auth$token.refreshToken,sid=_getState$auth$token.sid;token.refresh(refreshToken);dispatch(refreshRequest());_context4.prev=3;_context4.next=6;return axios.post('auth/refresh',{sid:sid});case 6:response=_context4.sent;dispatch(refreshSuccess({accessToken:\"Bearer \".concat(response.data.newAccessToken),refreshToken:\"Bearer \".concat(response.data.newRefreshToken),sid:response.data.newSid}));_context4.next=14;break;case 10:_context4.prev=10;_context4.t0=_context4[\"catch\"](3);dispatch(refreshError(_context4.t0===null||_context4.t0===void 0?void 0:_context4.t0.message));throw new Error(_context4.t0===null||_context4.t0===void 0?void 0:_context4.t0.message);case 14:case\"end\":return _context4.stop();}}},_callee4,null,[[3,10]]);}));return function(_x4,_x5){return _ref4.apply(this,arguments);};}();};export{register,logIn,logOut,refreshOperation};","map":{"version":3,"sources":["/home/bogdan/project-manager-app/src/redux/auth/auth-operations.js"],"names":["axios","registerRequest","registerError","loginRequest","loginSuccess","loginError","logoutRequest","logoutSuccess","logoutError","refreshRequest","refreshSuccess","refreshError","defaults","baseURL","token","set","headers","common","Authorization","get","refresh","refreshToken","unset","register","user","dispatch","post","logIn","message","response","data","accessToken","sid","email","logOut","window","location","reload","refreshOperation","getState","auth","newAccessToken","newRefreshToken","newSid","Error"],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport {\n  registerRequest,\n  registerError,\n  loginRequest,\n  loginSuccess,\n  loginError,\n  logoutRequest,\n  logoutSuccess,\n  logoutError,\n  refreshRequest,\n  refreshSuccess,\n  refreshError,\n} from './auth-actions';\n\naxios.defaults.baseURL = 'https://sbc-backend.goit.global';\n\nexport const token = {\n  token: '',\n\n  set(token) {\n    axios.defaults.headers.common.Authorization = `Bearer ${token}`;\n    this.token = `Bearer ${token}`;\n  },\n  get() {\n    return this.token;\n  },\n  refresh(refreshToken) {\n    this.token = refreshToken;\n    axios.defaults.headers.common.Authorization = refreshToken;\n  },\n  unset() {\n    axios.defaults.headers.common.Authorization = '';\n    this.token = '';\n  },\n};\n\nconst register = user => async dispatch => {\n  dispatch(registerRequest());\n  try {\n    await axios.post('/auth/register', user);\n    dispatch(logIn(user));\n  } catch (error) {\n    dispatch(registerError(error?.message));\n  }\n};\n\nconst logIn = user => async dispatch => {\n  dispatch(loginRequest());\n  try {\n    const response = await axios.post('/auth/login', user);\n    token.set(response.data.accessToken);\n    dispatch(\n      loginSuccess({\n        accessToken: token.get(),\n        refreshToken: `Bearer ${response.data.refreshToken}`,\n        sid: response.data.sid,\n        email: response.data.data.email,\n      }),\n    );\n  } catch (error) {\n    dispatch(loginError(error?.message));\n  }\n};\n\nconst logOut = () => async dispatch => {\n  dispatch(logoutRequest());\n  try {\n    await axios.post('/auth/logout');\n    token.unset();\n    dispatch(logoutSuccess());\n    window.location.reload();\n  } catch (error) {\n    dispatch(logoutError(error?.message));\n  }\n};\n\nconst refreshOperation = () => async (dispatch, getState) => {\n  const { refreshToken, sid } = getState().auth.token;\n  token.refresh(refreshToken);\n  dispatch(refreshRequest());\n\n  try {\n    const response = await axios.post('auth/refresh', { sid: sid });\n\n    dispatch(\n      refreshSuccess({\n        accessToken: `Bearer ${response.data.newAccessToken}`,\n        refreshToken: `Bearer ${response.data.newRefreshToken}`,\n        sid: response.data.newSid,\n      }),\n    );\n  } catch (error) {\n    dispatch(refreshError(error?.message));\n\n    throw new Error(error?.message);\n  }\n};\nexport { register, logIn, logOut, refreshOperation };\n"]},"metadata":{},"sourceType":"module"}